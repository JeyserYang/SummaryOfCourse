### 计算机网络

#### 基础

* 计算机网络的组成

    从组成部分上看，计算机网络主要由**硬件，软件，协议**组成；从功能组成上看，计算机网络由**通信子网，资源子网**组成。OSI模型中的下三层属于通信子网，上三层属于资源子网。且中继器，集线器，网桥，交换机，路由器属于下三层的设备，它们隶属于资源资源。

* 广域网，局域网，互联网的区别

    广域网是使用交换机连接多个局域网形成的更大型的网络，主要在于使用了交换机。互联网是使用路由器连接广域网和局域网的网络，主要在于使用路由器。广域网使用的是**点对点网络（交换机之间）**，局域网使用的**广播技术**。典型的局域网有 **有线局域网（通常称为以太网）** 和 **无线局域网（802.11）**

* PDU，SAP，Protocol的概念

    PDU（协议数据单元），如物理层的PDU叫比特，数据链路层PDU叫帧，网络层PDU叫分组

    SAP（服务访问点），可以理解为上下层交互的接口

    Protocol（协议），由**语法，语义，同步**组成

* OSI七层模型，TCP/IP四层模型和综合的五层模型

    OSI七层模型：物理层，数据链路层，网络层（主机与主机），传输层（端到端（进程）），会话层（用于同步），表示层（数据加工，加密解密等），应用层。

    TCP/IP模型：下两层叫做网络接口层，网络层，传输层，应用层（上三层）

    五层模型：**物理层，数据链路层，网络层，传输层，应用层。**

#### 物理层

* 奈奎斯特定理和香农定理

    奈奎斯特定理：指理想低通信道中的极限数据传输速率，公式为：

            速率 = 2 * W * log(V)
    其中，W表示理想低通信道的带宽，单位为HZ， V为每个码元所需要的电平数（或二进制位数）

    香农定理：在有噪声干扰的信道的极限传输速率，公式为：

            速率 = W * log( 1 + S/N )
    其中，W为信道带宽，S/N为信噪比。

    **注：极限传输速率等于两者最小的那个**

* 编码
    
    **非归零码（NRZ）：使用低电平代表0，高电平代表1（或者相反，下同）**

    NRZ-I：使用电平反转代表0，不反转代表1

    **曼彻斯特：将一个码元划分为两个相等的间隔，前一个间隔为高电平后一个为低电平代表1，反之代表0，用于以太网的传输**

    差分曼彻斯特：若码元为1，则前半个码元的电平与上一个码元的后半电平相同。若为0，则相反。

* 调制成模拟信号

    幅移键控（ASK），频移键控（FSK），相移键控（PSK）

    QAM调制：将幅移键控和相移键控集合起来，形成叠加信号，设波特率为B，采用m个相位，每个相位n中振幅，则数据传输速率R为：

            R = B * log( m * n)

* 电路交换，报文交换和分组交换

    电路交换：在进行数据传输前，需要建立一条专用的**物理通信链路**。需要有 **建立连接，数据传输和连接释放**三个阶段

    报文交换：数据交换的单位是报文，报文携带目的地址，源地址等信息。在交换结点采用存储转发的方式。

    分组交换：同报文交换一样，分组交换也采用**存储转发**，主要是将大的报文分为多个小的分组进行转发。分组交换又分为面向连接的虚电路和无连接的数据报。

    **电路交换必须有建立连接的时间，分组交换没有建立时延，但是增加了存储转发的开销。**

* **物理层的比特流传输时间（在各种交换的情况下）**

    在一个分组交换网中，采用虚电路方式转发分组，分组的首部和数据部分分别为h位和p位，现有L(>>p)的报完要通过该网络传输，源点和终点之间有k条链路，每条链路的传播时延为d，数据传输速率为b，虚电路建立时间为s，每个中间结点有m秒的处理时延，求源点开始发送数据到终点收到全部数据所需要的时间？

    答： 总传输时间 = 建立时间 + 将L位报文发送到链路中的传输时延 + 传播时延 + 处理时延 + 转发时延

    其中建立时间为s，分组数： L / P， 每个分组传输时延： (p + h) / b,总共传输时延 =
    L * (p + h) / (p * b)；传播时延 = kd；处理时延 = (k - 1) * m；转发时延 = (k - 1) * (p + h) / b.

* 传输介质和物理层设备

    传输介质：同轴电缆，双绞线，光纤

    物理层设别：中继器（将衰减的信号整形再生），集线器（Hub）（多端口中继器）

#### 数据链路层

* 组帧（接收方应当从接收到的二进制比特流区分帧的开始和终止）

    字符填充的首尾定界法，**比特填充的首尾标志法，以01111110为帧的开始和结束标志，如果数据中存在5个连续的1则自动在其后添加一个0**

* 差错控制

    * 检错编码

        奇偶校验码：在有效数据位后面增加一个冗余位，只能检测奇数位错误

        CRC（循环冗余码）

    * 纠错编码（海明码）

* **流量控制（滑动窗口）**

    ARQ（自动重传请求），通过接收方请求发送方重传出错的帧来恢复出错的帧。共分为三种，停等ARQ，Go-Back-N，SR。

    Stop-Wait：接收窗口和发送窗口大小均为1，当发送完一个数据帧就停止并等待，直到收到来自接收方的确认信号。

    回退N帧：发送窗口大小为 2^n - 1, 接收窗口大小为1。它有一种**捎带确认**的效果，即对某一数据帧的确认表示该数据帧和这以前的所有的数据帧都已正确无误的收到了。同时，如果某个帧丢失，则该帧和其后发送过的帧都需要重传。

    选择性重传：发送窗口和接收窗口大小均为 2^(n-1).

* 介质访问控制

    用决定**广播信道（局域网）**中信道的分配的协议属于数据链路层的介质访问控制（MAC）子层。

    常见的介质访问控制方法有：信道划分介质访问控制，随机访问介质访问控制，轮询访问介质访问控制。

* 信道划分介质访问控制（使用的是多路复用技术）

    频分多路复用（FDM），时分多路复用（TDM），码分多路复用（CDM），码分多址（CDMA）是CDM的一种形式

* **随机访问介质访问控制**

    纯Aloha：直接发送数据，一旦发生碰撞，则间隔随机时间重发

    CSMA： 1-坚持，侦听信道，如果空闲则以概率1发送数据；如果忙，则一直继续侦听。 非坚持，侦听信道，如果空闲则立即发送数据如果忙，则随机时间再侦听。 p-坚持，侦听信道，如果忙，则等随机时间再侦听；如果空闲，则以概率p发送数据，以概率1-p等待随机时间侦听。

    CSMA/CD（冲突检测，用于以太网）：先听后发，边听边发，冲突停发，随机重发。

    > 边听边发：假设从A和B之间发送数据，A在发送数据的同时，侦听信道中是否有其他端发送数据（这里是B），如果存在，则直接停止发送，等待一段随机事件重发。

    > 在上面的例子中，站A最多需要 2 * t 的时间就知道当前所发送的帧是否发送碰撞。 t 为单程传播时延。我们程 2 * t 为争用期。为了**确保在发送数据的同时能检测到可能存在的冲突**，需要在发送完一个帧之前就能收到自己发送的数据，即**帧的传输时延至少要两倍于争用期**。因此，可以通过运算得到以太网的最小帧长为64B。

    > 随机重发：CSMA/CD还能从发生冲突中恢复，其中使用的**二进制指数退避算法**。假设k为重传次数，每次都在 0 ~ 2^k-1 中选择一个 **数乘以争用期** 作为重传的随机等待时间。其中注意： **重传16次不成功则代表网络拥塞严重，则抛弃此帧并向高层报告错误**，k = { 重传次数， 10 }， 也就是说，当重传次数为11到15时， k 的值仍为 10.

    CSMA/CS（冲突避免，用于无线局域网）：冲突避免不是完全避免碰撞，而是指尽量减少碰撞发生的概率。其中使用 **预约信道，ACK帧，RTS/CTS帧**等来实现碰撞避免。注：**CSMA/CA在发送包的同时不能检测冲突**

* MAC帧

    以太网的MAC帧的首部和尾部总共站 18B， 因此IP数据部分范围为 46B(64-18) ~ 1500B(规定)。MAC地址（也称物理地址），共6个字节。常见写法为： 00-45-8c-4e-b1-21

* 广域网使用的协议（区别于局域网的CSMA/CD和CSMA/CA）

    PPP协议和HDLC协议是广域网使用的数据链路层的协议（用于交换机之间的帧传输的协议）

    PPP协议（也称点对点协议），提供差错检测（CRC）无纠错功能，实现的是**不可靠传输**，不使用**序号和确认机制**，只支持**全双工通信**。 **（面向字节）**

    HDLC协议：**面向比特**，提供可靠传输，有序号和确认机制，根据控制信号的不同分为信息帧（I），监督帧（S），无编号帧（U）三种

* 数据链路层设备

    网桥，交换机（多端口网桥），用交换机连接是局域网，每个局域网使用的CSMA/CD或者CSMA/CA协议，它们都是应对**冲突**产生的。因此每个局域网就是一个冲突域。而交换机正好隔离了冲突域。

#### 网络层

* IPv4

    IPv4分组格式： 版本，首部长度（4位），总长度（16位），片偏移（13位），首部校验和（16位），生存时间TTL（8位），源地址（32位），目的地址等。

    其中，首部长度，总长度，片偏移的单位分别为 4B， 1B， 8B。也就是说首部长度范围为 20B ~ 60B（15 * 4B）。

* 为了节省IPv4地址消耗的手段

    * NAT：网络地址转换

    * 子网划分和子网掩码：在原来的划分中，将主机号分为子网号和主机号。注：**主机号全为0的地址为本网络的子网的网络号，主机号全为1为广播地址**

    * CIDR（无分类编址）：将IP地址分为 { 网络前缀， 主机号 }，形如 128.14.32.5/20，则IP地址的前20位位网络前缀，也就是网络号，后12位为主机号。其中CIDR存在**路由聚合技术**，即将202.16.0.0/17和202.16.128.0/17合并成一个子网为 202.16.0.0/16.

    * 当使用CIDR时，路由表中的每一个表项由“网络前缀”和“下一跳地址”组成，在查找路由表时可能会得到不止一个匹配结果。应当从匹配结果中选择网络前缀最长的路由，称为**最长前缀匹配**

    * IPv6从根本上解决

* ARP，DHCP，ICMP协议

    ARP（地址解析协议）：一个路由器由于互联多个网络，不仅有多个IP地址，还有多个MAC地址。当在局域网传播数据帧时，必须使用MAC地址，因此当路由到指定网络的路由器时，路由器需要能够将**IP地址转换为MAC地址**，这就是ARP。**工作在网络层**。

    DHCP（动态主机配置协议）：动态给主机分配IP地址，属于**应用层协议，基于UDP**

    ICMP（网际控制报文协议）：**IP协议**，ICMP报文分为ICMP差错报文和询问报文两种。

    ICMP差错报文共有五种类型： **源点抑制，终点不可达，超时**，参数问题，改变路由

    ICMP询问报文典型的有： ping命令。

* 路由协议（路由算法，用于更新路由器中的路由表信息）

    * 内部网关协议（IGP）（在同一个自治系统（AS））

        > RIP（基于距离-向量）路由协议：仅和相邻路由器交换信息，存在**慢收敛现象**，即“坏消息传得慢”。

        > OSPF（链路状态）路由协议：基于**洪泛法**，即当链路状态发生变化时，使用洪泛法向所有的路由器发送消息，让所有的路由器通过使用**dijikstra算法更新最短路径**。

    * 外部网关协议（EGP）（不同自治系统之间的协议）

        > BGP（边界网关协议）：采用**路径-向量路由**选择，**应用层协议基于TCP**

#### 传输层

* UDP和TCP
    
    UDP：面向无连接，不可靠的协议

    TCP：面向连接，可靠的协议。TCP连接的端口叫做套接字 <主机IP地址，端口号>

    组成： 源端口和目的端口字段，各占2字节。

    序号字段（4字节），TCP是**面向字节**的，如果当前发送的TCP报文序号为 301， 且TCP报文的数据共有100B， 则下一个发送的序号就为401.

    确认号字段（小写的ack，4字节）：是期望下一次收到的报文段序号，比如发送的确认号为201，就代表希望发送者下一次发送的TCP报文的序号是201。

    确认位（大写的ACK，1bit）：当ACK=1时，确认号字段才有效。

    同步位（SYN）：当SYN=1时，代表这个TCP报文是一个请求连接和连接接受报文。

    终止位（FIN）：当FIN=1时，代表终止连接。

* **TCP连接的三次握手和TCP释放的四次挥手**

    三次握手：1）客户端TCP向服务器TCP发送一个请求发送报文，其中SYN标志设置为1，客户机随机选择一个序号 seq=x 发送给服务器。 2）服务器TCP接收到请求后，如同意连接，发送一个确认报文，置SYN和ACK都为1，其中，也随机选择一个序号 seq=y 作为这个TCP报文序号。且这个报文的 ack = x+1. 3）前两个报文都不包含数据部分，当客户机收到确认报文后，还要向服务器发出确认，。这个报文段的ACK为1，没有SYN。序号字段为 x+1， 确认字段为 ack=y+1.

    四次挥手：1）当客户机准备释放连接时，发送一个报文，假设此时序号为u，置FIN为1，由于**TCP是全双工通信**，所以发送FIN的一端不再能发送数据，但是服务器端仍然可以发送数据。 2）服务器端收到连接释放，发出确认报文，报文的 ack=u+1，此时从客户端到服务器端的连接就释放了，TCP连接处于**半关闭状态**。 3）若服务器已经没有数据向客户端发送，也发送一个释放报文，置FIN为1
    4）客户机收到连接释放报文，也发出一个确认信号。

* TCP流量控制（滑动窗口）和拥塞控制（慢开始和拥塞避免）（看书吧）

#### 应用层

* DNS域名解析系统

    将`www.baidu.com`解析成IP地址

* FTP(文件传输协议)，SMTP（邮件传输协议），HTTP（超文本传输协议），都**基于TCP**